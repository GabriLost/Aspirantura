<?xml version="1.0" encoding="UTF-8"?>
<atlassian-plugin key="${project.groupId}.${project.artifactId}" name="${project.name}"
                  plugins-version="2">
    <plugin-info>
        <description>${project.description}</description>
        <version>${project.version}</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}"/>
    </plugin-info>

    <!-- I18N -->
    <resource type="i18n" name="i18n" location="/ru/sbertech/atlas/jira/cupintegration/i18n/cupIntegration"/>

    <!-- preview -->
    <web-resource key="sbtManualCupIntegrationResources" name="Sbt Manual Cup Integration Web Resources">
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        <dependency>com.atlassian.auiplugin:aui-date-picker</dependency>
        <resource type="download" name="cupIntegration.css"
                  location="/ru/sbertech/atlas/jira/cupintegration/css/cupIntegration.css"/>
        <resource type="download" name="manualCupIntegration.js"
                  location="/ru/sbertech/atlas/jira/cupintegration/js/manualCupIntegration.js"/>
        <context>manualcupintegrationcontext</context>
    </web-resource>

    <web-resource key="sbtCupIntegrationResources" name="Sbt Cup Integration Web Resources">
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        <resource type="download" name="configureExport.js"
                  location="/ru/sbertech/atlas/jira/cupintegration/js/configureExport.js"/>
        <context>cupintegrationcontext</context>
    </web-resource>

    <web-resource key="sbtCupImportResources" name="Sbt Cup Import Web Resources">
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        <dependency>com.atlassian.auiplugin:aui-select2</dependency>
        <resource type="download" name="cupIntegration.css"
                  location="/ru/sbertech/atlas/jira/cupintegration/css/cupIntegration.css"/>
        <resource type="download" name="configureImport.js"
                  location="/ru/sbertech/atlas/jira/cupintegration/js/configureImport.js"/>
        <resource type="download" name="uploader.js"
                  location="/ru/sbertech/atlas/jira/cupintegration/js/uploader.js"/>
        <context>cupimportcontext</context>
    </web-resource>

    <web-resource key="sbtCronSettingsResources" name="Cron Settings Resources">
        <resource type="download" name="later.min.js"
                  location="/ru/sbertech/atlas/jira/cupintegration/js/lib/later.min.js"/>
        <context>cronsettingscontext</context>
    </web-resource>

    <web-resource key="codeMirror" name="Code Mirror">
        <resource type="download" name="codemirror.js"
                  location="/ru/sbertech/atlas/jira/cupintegration/js/lib/codemirror.js"/>
        <resource type="download" name="xml.js"
                  location="/ru/sbertech/atlas/jira/cupintegration/js/lib/xml.js"/>
        <resource type="download" name="formatting.js"
                  location="/ru/sbertech/atlas/jira/cupintegration/js/lib/formatting.js"/>
        <resource type="download" name="codemirror.css"
                  location="/ru/sbertech/atlas/jira/cupintegration/css/codemirror.css"/>
        <context>codemirror</context>
    </web-resource>

    <webwork1 key="manualTimeSheetExport" name="manualTimeSheetExport" class="java.lang.Object">
        <actions>
            <action name="ru.sbertech.atlas.jira.cupintegration.out.action.ManualTimeSheetExportAction"
                    alias="ManualTimeSheetExportAction">
                <view name="input">
                    /ru/sbertech/atlas/jira/cupintegration/templates/manualTimeSheetExportView.vm
                </view>
            </action>
        </actions>
    </webwork1>

    <webwork1 key="configureTimeSheetExport" name="configureTimeSheetExport" class="java.lang.Object">
        <actions>
            <action name="ru.sbertech.atlas.jira.cupintegration.out.action.ConfigureTimeSheetExportAction"
                    alias="ConfigureTimeSheetExportAction">
                <view name="input">
                    /ru/sbertech/atlas/jira/cupintegration/templates/configureTimeSheetExportView.vm
                </view>
            </action>
        </actions>
    </webwork1>

    <webwork1 key="manualImport" name="manualImport" class="java.lang.Object">
        <actions>
            <action name="ru.sbertech.atlas.jira.cupintegration.in.action.ManualImportAction"
                    alias="ManualImportAction">
                <view name="input">
                    /ru/sbertech/atlas/jira/cupintegration/templates/manualImportView.vm
                </view>
            </action>
        </actions>
    </webwork1>

    <webwork1 key="configureImport" name="configureImport" class="java.lang.Object">
        <actions>
            <action name="ru.sbertech.atlas.jira.cupintegration.in.action.ConfigureImportAction"
                    alias="ConfigureImportAction">
                <view name="input">
                    /ru/sbertech/atlas/jira/cupintegration/templates/configureImportView.vm
                </view>
            </action>
        </actions>
    </webwork1>

    <webwork1 key="epicSyncAction" name="epicSyncAction" class="java.lang.Object">
        <actions>
            <action name="ru.sbertech.atlas.jira.cupintegration.issuerendering.webaction.EpicSyncAction"
                    alias="EpicSyncAction">
                <view name="input">/ru/sbertech/atlas/jira/cupintegration/templates/epicSyncActionInput.vm</view>
                <view name="error">/ru/sbertech/atlas/jira/cupintegration/templates/epicSyncActionError.vm</view>
                <view name="success">/ru/sbertech/atlas/jira/cupintegration/templates/epicSyncActionSuccess.vm</view>
            </action>
        </actions>
    </webwork1>

    <web-section key="cupIntegrationPluginSection" name="Cup Integration Plugin Section"
                 location="system.admin.top.navigation.bar" weight="160"
                 i18n-name-key="ru.sbertech.atlas.jira.cupintegration.plugin.name.label">
        <condition class="com.atlassian.jira.plugin.webfragment.conditions.UserIsAdminCondition"/>
        <label key="ru.sbertech.atlas.jira.cupintegration.plugin.name.label"/>
    </web-section>

    <web-section key="timesheetExportSection" name="TimeSheet Export"
                 location="cupIntegrationPluginSection"
                 i18n-name-key="ru.sbertech.atlas.jira.cupintegration.timesheet.export" weight="10">
        <label key="ru.sbertech.atlas.jira.cupintegration.timesheet.export"/>
        <condition class="com.atlassian.jira.plugin.webfragment.conditions.UserIsAdminCondition"/>
    </web-section>

    <web-item key="manualTimesheetExport" name="Manual Export"
              section="cupIntegrationPluginSection/timesheetExportSection" weight="10">
        <label key="ru.sbertech.atlas.jira.cupintegration.manualexport.name"/>
        <link linkId="manual-export-link">/secure/admin/ManualTimeSheetExportAction!default.jspa
        </link>
    </web-item>

    <web-item key="configureTimesheetExport" name="Configure Export"
              section="cupIntegrationPluginSection/timesheetExportSection" weight="20">
        <label key="ru.sbertech.atlas.jira.cupintegration.export.configure"/>
        <link linkId="configure-export-link">
            /secure/admin/ConfigureTimeSheetExportAction!default.jspa
        </link>
    </web-item>

    <web-section key="importSection" name="Import"
                 location="cupIntegrationPluginSection"
                 i18n-name-key="ru.sbertech.atlas.jira.cupintegration.import.name" weight="20">
        <label key="ru.sbertech.atlas.jira.cupintegration.import.name"/>
        <condition class="com.atlassian.jira.plugin.webfragment.conditions.UserIsAdminCondition"/>
    </web-section>

    <web-item key="manualCupImport" name="Manual Import"
              section="cupIntegrationPluginSection/importSection" weight="10">
        <label key="ru.sbertech.atlas.jira.cupintegration.manualimport.name"/>
        <link linkId="manual-import-link">/secure/admin/ManualImportAction!default.jspa</link>
    </web-item>

    <web-item key="configureCupImport" name="Configure Import"
              section="cupIntegrationPluginSection/importSection" weight="20">
        <label key="ru.sbertech.atlas.jira.cupintegration.import.configure"/>
        <link linkId="configure-import-link">/secure/admin/ConfigureImportAction!default.jspa</link>
    </web-item>

    <web-item key="epicSyncIssue" i18n-name-key="ru.sbertech.atlas.jira.cupintegration.epic.synchronization.name" name="Sync issue"
              section="operations-delete" weight="10">
        <label key="ru.sbertech.atlas.jira.cupintegration.epic.synchronization.name"/>
        <tooltip key="ru.sbertech.atlas.jira.cupintegration.epic.synchronization.name"/>
        <styleClass>sync-issue-style</styleClass>
        <condition class="com.atlassian.jira.plugin.webfragment.conditions.HasIssuePermissionCondition">
            <param name="permission">edit</param>
        </condition>
        <condition class="ru.sbertech.atlas.jira.cupintegration.condition.EpicCondition"/>
        <link linkId="sync-issue">
            /secure/EpicSyncAction!default.jspa?epicId=$issue.key
        </link>
    </web-item>

    <web-resource name="epicDialogResource" i18n-name-key="scheduler-web-resource.name" key="scheduler-web-resource">
        <description key="scheduler-web-resource.description">The Scheduler Web Resource Plugin</description>
        <context>atl.general</context>
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>
        <resource type="download" name="scheduler.js" location="ru/sbertech/atlas/jira/cupintegration/js/scheduler.js">
            <property key="content-type" value="text/javascript"/>
        </resource>
    </web-resource>

    <!-- search request view -->
    <search-request-view key="extendedSearchRequestXML" name="CUP XML"
                         class="ru.sbertech.atlas.jira.cupintegration.out.xmlview.ExtendedSearchRequestView"
                         state='enabled'
                         fileExtension="xml"
                         contentType="text/xml">
        <resource type="velocity" name="header"
                  location="ru/sbertech/atlas/jira/cupintegration/templates/plugins/searchrequestviews/searchrequest-xml-header.vm"/>
        <resource type="velocity" name="footer"
                  location="templates/plugins/searchrequestviews/searchrequest-xml-footer.vm"/>
        <order>10</order>
    </search-request-view>

    <single-issue-view key="extendedIssueXMLView" name="CUP XML"
                       class="ru.sbertech.atlas.jira.cupintegration.out.xmlview.ExtendedIssueView" state='enabled'
                       fileExtension="xml"
                       contentType="text/xml">
        <resource type="velocity" name="view"
                  location="ru/sbertech/atlas/jira/cupintegration/templates/plugins/issueviews/single-xml.vm"/>
        <resource type="velocity" name="header"
                  location="ru/sbertech/atlas/jira/cupintegration/templates/plugins/issueviews/single-xml-header.vm"/>
        <resource type="velocity" name="footer"
                  location="ru/sbertech/atlas/jira/cupintegration/templates/plugins/issueviews/single-xml-footer.vm"/>
        <order>10</order>
    </single-issue-view>

    <component key="timesheetGenerator" class="ru.sbertech.atlas.jira.cupintegration.out.TimesheetGenerator">
    </component>

    <component key="cupIntegrationPluginSettingsManager"
               class="ru.sbertech.atlas.jira.cupintegration.out.service.PluginSettingsService"/>

    <component key="extendedSearchRequestViewBodyWriterUtil"
               class="ru.sbertech.atlas.jira.cupintegration.out.xmlview.ExtendedSearchRequestViewBodyWriterUtil"/>

    <component key="issueImportService" class="ru.sbertech.atlas.jira.cupintegration.in.service.IssueImportService"/>

    <component key="releaseImportService"
               class="ru.sbertech.atlas.jira.cupintegration.in.service.ReleaseImportService"/>

    <component key="importSettingService"
               class="ru.sbertech.atlas.jira.cupintegration.in.service.ImportSettingsServiceJiraStorage"/>

    <component key="releaseMappingService"
               class="ru.sbertech.atlas.jira.cupintegration.in.service.ReleaseMappingServiceJiraStorage"/>

    <component key="importReleaseValidator" class="ru.sbertech.atlas.jira.cupintegration.in.validator.ImportReleaseValidator"/>

    <component key="paramsEnricher" class="ru.sbertech.atlas.jira.cupintegration.in.ParamsEnricher"/>

    <component key="objectsUploadService"
               class="ru.sbertech.atlas.jira.cupintegration.in.service.ObjectsUploadService"/>

    <component key="epicIssueSyncProcessor"
               class="ru.sbertech.atlas.jira.cupintegration.issuerendering.processor.EpicIssueSyncProcessorImpl">
        <interface>ru.sbertech.atlas.jira.cupintegration.issuerendering.processor.EpicIssueSyncProcessor</interface>
    </component>

    <component key="epicSyncSearchService"
               class="ru.sbertech.atlas.jira.cupintegration.issuerendering.service.EpicSyncSearchServiceImpl">
        <interface>ru.sbertech.atlas.jira.cupintegration.issuerendering.service.EpicSyncSearchService</interface>
    </component>


    <ao key="AOMappingEntity">
        <entity>ru.sbertech.atlas.jira.cupintegration.in.model.MappingEntity</entity>
    </ao>

    <component-import key="ao" name="Active Objects service"
                      interface="com.atlassian.activeobjects.external.ActiveObjects">
        <description>Component to access Active Objects functionality from the plugin</description>
    </component-import>


    <component key="mappingRepository"
               class="ru.sbertech.atlas.jira.cupintegration.in.repository.ActiveObjectMappingRepository">
        <interface>ru.sbertech.atlas.jira.cupintegration.in.repository.IMappingRepository</interface>
    </component>

    <!-- imported components -->
    <component-import key="pluginSettingsFactory"
                      interface="com.atlassian.sal.api.pluginsettings.PluginSettingsFactory"/>
    <!-- REST -->
    <rest key="sbtJiraCupIntegration" name="SberTech Jira Cup Integration" path="/cupintegration" version="1.0"
          description="REST endpoints for the SberTech Jira Cup Integration."/>

    <component-import key="sbertechManagerUserinfo"
                      interface="ru.sbertech.atlas.jira.userenrich.manager.UserInfoManager"/>

    <component-import key="pluginScheduler">
        <description>SAL Scheduler</description>
        <interface>com.atlassian.sal.api.scheduling.PluginScheduler</interface>
    </component-import>

    <jql-function key="worklogPeriod"
                  i18n-name-key="jql.function.plugin.now.name"
                  name="worklogPeriod"
                  class="ru.sbertech.atlas.jira.cupintegration.out.worklog.jql.WorklogPeriodJqlFunction">
        <description>worklogPeriod</description>
        <fname>worklogPeriod</fname>
        <list>true</list>
    </jql-function>
</atlassian-plugin>

